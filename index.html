<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Apex Typing: Cloud Save Edition</title>
    <style>
        :root { 
            --bg: #0b0e14; --panel: #161a25; --neon: #00ff88; --gold: #ffd700;
            --pinky: #f472b6; --ring: #60a5fa; --middle: #4ad361; --index: #fbbf24;
        }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
        
        /* Progress Dashboard */
        .dashboard { width: 100%; background: var(--panel); padding: 10px; display: flex; justify-content: center; gap: 10px; border-bottom: 2px solid var(--neon); align-items: center; }
        .user-info { margin-right: 20px; color: var(--gold); font-weight: bold; border: 1px solid var(--gold); padding: 5px 10px; border-radius: 5px; }
        .lvl-box { padding: 6px 15px; background: #2d3748; border-radius: 8px; font-size: 13px; color: #718096; }
        .lvl-active { background: var(--neon); color: black; font-weight: bold; }

        /* HUD */
        .hud { padding: 15px; font-size: 22px; font-weight: bold; color: var(--neon); display: flex; gap: 40px; }

        /* Typing Area */
        .screen { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; }
        #target-text { font-size: 40px; font-family: 'Courier New', monospace; letter-spacing: 5px; color: #334155; text-align: center; }
        .char-current { color: white; border-bottom: 5px solid var(--neon); }
        .char-correct { color: var(--neon); }
        .char-wrong { color: #ff3d00; background: rgba(255, 61, 0, 0.2); }

        /* SAVE PROGRESS BOX */
        #auth-panel { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .auth-card { background: var(--panel); padding: 40px; border-radius: 20px; border: 2px solid var(--neon); text-align: center; width: 350px; }
        input { width: 80%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid var(--neon); background: #000; color: white; font-size: 16px; text-align: center; }
        
        .btn-save { background: var(--gold); color: black; padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-left: 20px; }
        button { padding: 15px 40px; font-size: 20px; background: var(--neon); border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 10px; }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    </style>
</head>
<body>

    <div id="auth-panel">
        <div class="auth-card">
            <h1 style="color: var(--neon);">ðŸ‘¤ STUDENT PORTAL</h1>
            <p>Enter your details to save progress</p>
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="App Password">
            <button onclick="handleLogin()">START ACADEMY</button>
            <p style="font-size: 10px; color: #666; margin-top: 15px;">Your data is saved locally on this PC.</p>
        </div>
    </div>

    <div id="win-modal" class="modal">
        <h1 style="color: var(--neon); font-size: 40px;">LEVEL COMPLETE</h1>
        <p id="level-stats" style="font-size: 20px;"></p>
        <button onclick="nextLevel()">NEXT LESSON â®•</button>
    </div>

    <div class="dashboard">
        <div class="user-info" id="user-display">GUEST</div>
        <div id="lvl-bar" style="display:flex; gap:5px;"></div>
        <button class="btn-save" onclick="manualSave()">ðŸ’¾ SAVE DATA</button>
    </div>

    <div class="hud">
        <span>âš¡ WPM: <span id="wpm">0</span></span>
        <span>ðŸŽ¯ ACC: <span id="acc">100%</span></span>
    </div>

    <div class="screen">
        <div id="target-text"></div>
    </div>

    <script>
        const levels = [
            { name: "F & J", text: "ff jj ff jj f j f j" },
            { name: "D & K", text: "dd kk dk dk fd jk" },
            { name: "S & L", text: "ss ll sl sl ds kl" },
            { name: "A & ;", text: "aa ;; a; a; sa l;" },
            { name: "Master", text: "the future belongs to those who learn to code" }
        ];

        let currentUser = null;
        let curLvl = 0;
        let idx = 0, errs = 0, start = null, active = false;

        function handleLogin() {
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;

            if (user && pass) {
                currentUser = user;
                // Check if user already exists in local storage
                const savedData = localStorage.getItem('typingData_' + user);
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    curLvl = parsed.level || 0;
                    alert("Welcome back " + user + "! Resuming from Level " + (curLvl + 1));
                }
                
                document.getElementById('auth-panel').style.display = 'none';
                document.getElementById('user-display').innerText = currentUser.toUpperCase();
                active = true;
                init();
            } else {
                alert("Please enter a username and password!");
            }
        }

        function manualSave() {
            if (!currentUser) return;
            const data = {
                username: currentUser,
                level: curLvl,
                lastSaved: new Date().toLocaleString()
            };
            localStorage.setItem('typingData_' + currentUser, JSON.stringify(data));
            alert("Progress Synced! Your Level " + (curLvl + 1) + " status is secured.");
        }

        function init() {
            const bar = document.getElementById('lvl-bar');
            bar.innerHTML = levels.map((l, i) => 
                `<div class="lvl-box ${i===curLvl?'lvl-active':''}">L${i+1}</div>`
            ).join('');
            
            const text = levels[curLvl].text;
            document.getElementById('target-text').innerHTML = text.split('').map((c, i) => 
                `<span class="char ${i===0?'char-current':''}">${c===' '?' ':c}</span>`
            ).join('');
            idx = 0; errs = 0; start = null;
        }

        window.addEventListener('keydown', (e) => {
            if (!active || e.key === "Shift") return;
            if (!start) start = Date.now();

            const text = levels[curLvl].text;
            const chars = document.querySelectorAll('.char');
            const target = text[idx];

            if (e.key === target) {
                chars[idx].className = 'char char-correct';
                idx++;
            } else {
                chars[idx].className = 'char char-current char-wrong';
                errs++;
            }

            const acc = Math.round(((idx - errs) / (idx || 1)) * 100);
            document.getElementById('acc').innerText = acc + "%";

            if (idx < text.length) {
                chars[idx].className = 'char char-current';
            } else {
                finish();
            }
        });

        function finish() {
            active = false;
            const time = (Date.now() - start) / 60000;
            const wpm = Math.round((levels[curLvl].text.length / 5) / time);
            document.getElementById('wpm').innerText = wpm;
            
            // Auto-Save after level complete
            manualSave();

            document.getElementById('level-stats').innerText = `${wpm} WPM | ${document.getElementById('acc').innerText} Accuracy`;
            document.getElementById('win-modal').style.display = 'flex';
        }

        function nextLevel() {
            document.getElementById('win-modal').style.display = 'none';
            curLvl++;
            if (curLvl >= levels.length) curLvl = 0;
            active = true;
            init();
        }
    </script>
</body>
</html>